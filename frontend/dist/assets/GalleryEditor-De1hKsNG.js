import{z as N,r as p,A as f,j as e,M as H,S as J,B as T,I as x,a8 as D,E as m,O as G,Q as y,U as I,L as K,N as k,G as Q}from"./index-CBHbDdlb.js";import W from"./Gallery-Nq6lJXhn.js";import{I as L}from"./index-BPxmFDBn.js";const{TabPane:X}=D,{TextArea:re}=x,Z=({isOpen:b,onClose:g})=>{const[j]=N.useForm(),[S,C]=p.useState(!1),[R,U]=p.useState(!1),[o,u]=p.useState(null),[_,F]=p.useState("gallery-box");p.useEffect(()=>{b&&M()},[b]);const M=async()=>{try{C(!0);const s=await fetch("http://localhost:8000/api/gallery/");if(!s.ok)throw new Error("Failed to fetch gallery data");const a=await s.json();u(a),j.setFieldsValue({title:a.title||""})}catch(r){console.error("Error fetching gallery data:",r),f.error("Failed to load gallery data.")}finally{C(!1)}},V=async(r,s,a=null)=>{const t=new FormData;t.append("image",r),t.append("category","gallery_images");try{U(!0);const i=await fetch("http://localhost:8000/api/images/",{method:"POST",body:t});if(!i.ok)throw new Error("Upload failed");const c=`${(await i.json()).image}`,n=o.sections.map(h=>{if(h.slug===s)if(a){const v=h.images.map(w=>w.id===a?{...w,image:c}:w);return{...h,images:v}}else{const v={id:Date.now(),image:c,primary_text:""};return{...h,images:[...h.images,v]}}return h});return u({...o,sections:n}),c}catch(l){return console.error("Upload error:",l),f.error("Image upload failed"),null}finally{U(!1)}},A=(r,s=null)=>({name:"image",showUploadList:!1,customRequest:async({file:a,onSuccess:t,onError:l})=>{const i=await V(a,r,s);i?t(i,a):l(new Error("Upload failed"))},beforeUpload:a=>{const t=a.type.startsWith("image/");if(!t)return f.error("You can only upload image files!"),I.LIST_IGNORE;const l=a.size/1024/1024<5;return l?t&&l:(f.error("Image must be smaller than 5MB!"),I.LIST_IGNORE)}}),$=r=>{const s=o.sections.map(a=>a.slug===r?{...a,images:[...a.images,{id:Date.now(),image:"",primary_text:""}]}:a);u({...o,sections:s})},O=r=>{const s=o.sections.map(a=>a.slug===r?{...a,videos:[...a.videos,{id:Date.now(),video:"",thumbnail:"",primary_text:""}]}:a);u({...o,sections:s})},P=(r,s)=>{const a=o.sections.map(t=>t.slug===r?{...t,images:t.images.filter(l=>l.id!==s)}:t);u({...o,sections:a})},B=(r,s)=>{const a=o.sections.map(t=>t.slug===r?{...t,videos:t.videos.filter(l=>l.id!==s)}:t);u({...o,sections:a})},E=(r,s,a,t,l)=>{const i=o.sections.map(d=>{if(d.slug===r)if(s==="image"){const c=d.images.map(n=>n.id===a?{...n,[t]:l}:n);return{...d,images:c}}else{const c=d.videos.map(n=>n.id===a?{...n,[t]:l}:n);return{...d,videos:c}}return d});u({...o,sections:i})},q=(r,s,a)=>{let t=a,l="";if(a.includes("youtube.com")||a.includes("youtu.be")){const d=z(a);d&&(t=`https://www.youtube.com/embed/${d}`,l=`https://img.youtube.com/vi/${d}/hqdefault.jpg`)}const i=o.sections.map(d=>{if(d.slug===r){const c=d.videos.map(n=>n.id===s?{...n,video:t,thumbnail:l}:n);return{...d,videos:c}}return d});u({...o,sections:i})},z=r=>{const s=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,a=r.match(s);return a&&a[2].length===11?a[2]:null},Y=async()=>{try{const s={title:(await j.validateFields()).title,sections:o.sections.map(l=>({id:l.id,title:l.title,slug:l.slug,images:l.images.filter(i=>i.image),videos:l.videos.filter(i=>i.video)}))},t=await fetch("http://localhost:8000/api/gallery/",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok){const l=await t.json();throw new Error(l.message||"Failed to save gallery data")}Q.fire({position:"top-end",icon:"success",title:"Gallery Content Updated Successfully",showConfirmButton:!1,timer:3e3}),g()}catch(r){console.error("Error saving gallery data:",r),f.error(r.message||"Failed to update gallery section")}};return o?e.jsx(H,{title:e.jsx("span",{className:"text-xl font-bold text-gray-800",children:"Edit Gallery Section"}),open:b,onCancel:g,footer:[e.jsx(m,{onClick:g,className:"px-6 h-10 rounded-lg border-gray-300 hover:bg-gray-100",children:"Cancel"},"back"),e.jsx(m,{type:"primary",onClick:Y,loading:S,className:"px-6 h-10 rounded-lg bg-blue-600 hover:bg-blue-700",children:"Save Changes"},"submit")],width:1e3,className:"rounded-lg overflow-hidden",styles:{body:{padding:"24px"}},destroyOnClose:!0,children:e.jsx(J,{spinning:S,children:e.jsxs(N,{form:j,layout:"vertical",className:"space-y-6",children:[e.jsx(T,{title:"Main Content",bordered:!1,className:"rounded-lg shadow-sm border-0",headStyle:{background:"linear-gradient(90deg, #f8f9fa 0%, #ffffff 100%)",borderBottom:"1px solid #e8e8e8"},children:e.jsx(N.Item,{name:"title",label:e.jsx("span",{className:"font-medium text-gray-700",children:"Section Title"}),rules:[{required:!0,message:"Please enter the title"}],children:e.jsx(x,{size:"large",placeholder:"e.g., Explore Stech Group Gallery",className:"rounded-lg hover:border-blue-400 focus:border-blue-400"})})}),e.jsx(T,{title:"Gallery Sections",bordered:!1,className:"rounded-lg shadow-sm border-0",headStyle:{background:"linear-gradient(90deg, #f8f9fa 0%, #ffffff 100%)",borderBottom:"1px solid #e8e8e8"},children:e.jsx(D,{activeKey:_,onChange:F,children:o.sections.map(r=>e.jsxs(X,{tab:r.title,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-4",children:"Images"}),e.jsx(m,{type:"primary",icon:e.jsx(G,{}),onClick:()=>$(r.slug),className:"mb-4 flex items-center bg-blue-600 hover:bg-blue-700",children:"Add Image"}),e.jsx(y,{dataSource:r.images,renderItem:s=>e.jsx(y.Item,{className:"p-4 border-b border-gray-200 last:border-b-0",children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{placeholder:"Primary Text",value:s.primary_text,onChange:a=>E(r.slug,"image",s.id,"primary_text",a.target.value),className:"rounded-lg hover:border-blue-400 focus:border-blue-400 mb-4"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{...A(r.slug,s.id),children:e.jsx(m,{icon:e.jsx(K,{}),loading:R,className:"h-10 rounded-lg bg-blue-600 hover:bg-blue-700 text-white",children:"Upload Image"})}),s.image&&e.jsx("div",{className:"relative w-32 h-32",children:e.jsx(L,{src:s.image,alt:"Gallery image",className:"w-full h-full object-cover"})})]})]}),e.jsx(m,{danger:!0,icon:e.jsx(k,{}),onClick:()=>P(r.slug,s.id)})]})})},s.id)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-4",children:"Videos"}),e.jsx(m,{type:"primary",icon:e.jsx(G,{}),onClick:()=>O(r.slug),className:"mb-4 flex items-center bg-blue-600 hover:bg-blue-700",children:"Add Video"}),e.jsx(y,{dataSource:r.videos,renderItem:s=>e.jsx(y.Item,{className:"p-4 border-b border-gray-200 last:border-b-0",children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{placeholder:"Primary Text",value:s.primary_text,onChange:a=>E(r.slug,"video",s.id,"primary_text",a.target.value),className:"rounded-lg hover:border-blue-400 focus:border-blue-400 mb-4"}),e.jsx(x,{placeholder:"Enter YouTube or video URL",value:s.video,onChange:a=>q(r.slug,s.id,a.target.value),className:"rounded-lg hover:border-blue-400 focus:border-blue-400 mb-4"}),s.thumbnail&&e.jsx("div",{className:"relative w-32 h-32 mt-4",children:e.jsx(L,{src:s.thumbnail,alt:"Video thumbnail",className:"w-full h-full object-cover"})})]}),e.jsx(m,{danger:!0,icon:e.jsx(k,{}),onClick:()=>B(r.slug,s.id)})]})})},s.id)})]})]},r.slug))})})]})})}):null},te=()=>{const[b,g]=p.useState(!1);return e.jsxs("div",{className:"flex gap-20 items-center justify-between p-20",children:[e.jsxs("div",{className:"flex flex-col gap-10",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>g(!0),children:"Gallery"}),e.jsx(Z,{isOpen:b,onClose:()=>g(!1)})]}),e.jsx("div",{className:"mockup-browser bg-white border-8 border-black p-2 h-[700px] overflow-y-scroll",children:e.jsxs("div",{className:"",children:[e.jsx("div",{className:"mockup-browser-toolbar m-10",children:e.jsx("div",{className:"input",children:"https://sample-website.com"})}),e.jsx("div",{className:"overflow-scroll",children:e.jsx(W,{})})]})})]})};export{te as default};
//# sourceMappingURL=GalleryEditor-De1hKsNG.js.map
